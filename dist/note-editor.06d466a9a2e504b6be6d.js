(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1015:function(e,t,o){"use strict";o.r(t),o.d(t,"NoteEditor",(function(){return Y}));var i=o(5),n=o.n(i),s=o(0),r=o.n(s),a=o(66),l=o(340);function c(){return r.a.createElement("svg",{className:"icon-chevron-right",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},r.a.createElement("rect",{x:"0",fill:"none",width:"24",height:"24"}),r.a.createElement("path",{d:"M10.11 21.19L8.7 19.78 16.48 12 8.7 4.22l1.41-1.41L19.3 12 10.11 21.19z"}))}var d=e=>{var{selectedSearchMatchIndex:t,numberOfMatchesInNote:o,setSearchSelection:i}=e;return r.a.createElement("div",{className:"search-results"},r.a.createElement("div",null,null===t?"".concat(o," ").concat(o>1?"Results":"Result"):"".concat(t+1," of ").concat(o)),r.a.createElement("span",{className:"search-results-next"},r.a.createElement(l.a,{disabled:o<=1,icon:r.a.createElement(c,null),onClick:e=>{i((o+(null!=t?t:-1)+1)%o)},title:"Next"})),r.a.createElement("span",{className:"search-results-prev"},r.a.createElement(l.a,{disabled:o<=1,icon:r.a.createElement(c,null),onClick:e=>{i((o+(null!=t?t:-1)-1)%o)},title:"Prev"})))};d.displayName="SearchResultsBar";var u=Object(a.b)(e=>{var{ui:{selectedSearchMatchIndex:t,numberOfMatchesInNote:o}}=e;return{selectedSearchMatchIndex:t,numberOfMatchesInNote:o}},e=>({setSearchSelection:t=>e({type:"STORE_SEARCH_SELECTION",index:t})}))(d),h=o(912),g=o(24),p=o(35),m=o(242),v=Object(a.b)(null,e=>({openShareDialog:()=>e(Object(m.showDialog)("SHARE"))}))(e=>{var{openShareDialog:t}=e;return r.a.createElement("div",{className:"tag-email-tooltip"},r.a.createElement("div",{className:"tag-email-tooltip__arrow"}),r.a.createElement("div",{className:"tag-email-tooltip__inside"},"Collaboration has moved. Press the Share icon in the toolbar to access the ",r.a.createElement("a",{href:"#",onClick:t},"Collaborate screen"),"."))}),f=o(461),b=e=>{if(!e||!window.getSelection)return 0;var t=window.getSelection();if(!t||t.rangeCount<1)return 0;var o=t.getRangeAt(0),i=o.cloneRange();return i.selectNodeContents(e),i.setEnd(o.endContainer,o.endOffset),i.toString().length};class S extends s.Component{constructor(){for(var e,t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];super(...o),e=this,n()(this,"inputField",void 0),n()(this,"inputObserver",void 0),n()(this,"caretPosition",0),n()(this,"state",{isComposing:!1}),n()(this,"completeSuggestion",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.identity,{onChange:o,note:i,tags:n,value:s}=e.props;if(s.length){var r=null;for(var a of n.values())if(!i.tags.includes(a.name)&&a.name.startsWith(s)){r=a.name;break}r&&o(r,()=>{var o;t(r),e.caretPosition=(null===(o=r)||void 0===o?void 0:o.length)||0,e.focusInput()})}})),n()(this,"focusInput",()=>{if(this.inputField){var e=this.inputField;e.focus();var t=document.createRange();t.selectNodeContents(e),null!==e.firstChild&&t.toString().length>this.caretPosition&&t.setEnd(e.firstChild,this.caretPosition),t.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(t)}}),n()(this,"hasFocus",()=>document.activeElement===this.inputField),n()(this,"interceptKeys",e=>Object(g.invoke)({13:this.submitTag,32:this.submitTag,188:this.submitTag,9:this.interceptTabPress,39:this.interceptRightArrow},e.keyCode,e)),n()(this,"interceptRightArrow",e=>{var{value:t}=this.props;b(e.currentTarget)===t.length&&(this.completeSuggestion(),e.preventDefault(),e.stopPropagation())}),n()(this,"interceptTabPress",e=>{this.completeSuggestion(this.submitTag),e.preventDefault(),e.stopPropagation()}),n()(this,"onInputMutation",e=>{e.forEach(e=>{var t=Object(g.get)(e,"target.data","");"childList"===e.type&&e.addedNodes.length&&(t=Object(g.get)(e,"target.innerText","")),this.onInput(t)})}),n()(this,"onInput",(function(t){var{moveCaretToEndOfValue:o=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.state.isComposing||(e.caretPosition=o?t.length:b(e.inputField),e.props.onChange(t.trim(),e.focusInput))})),n()(this,"onCompositionEnd",e=>{var t=e.target.textContent;this.setState({isComposing:!1},()=>this.onInput(t))}),n()(this,"parsePastedInput",e=>{var t;Object(g.get)(e,"clipboardData.getData")?t=e.clipboardData.getData("text/plain"):Object(g.get)(window,"clipboardData.getData")&&(t=window.clipboardData.getData("Text"));var o=t.split(/\s|,|\n/),i=o.slice(0,o.length-1),[n]=o.slice(o.length-1);i.filter(Boolean).forEach(this.props.onSelect),this.onInput(n,{moveCaretToEndOfValue:!0}),e.preventDefault(),e.stopPropagation()}),n()(this,"storeInput",e=>{this.inputField=e,this.props.inputRef(e),Object(g.invoke)(this,"inputField.addEventListener","paste",this.parsePastedInput,!1)}),n()(this,"submitTag",e=>{var{onSelect:t,value:o}=this.props;o.trim().length&&t(o.trim()),Object(g.invoke)(e,"preventDefault"),Object(g.invoke)(e,"stopPropagation")})}componentDidMount(){this.props.storeFocusInput(this.focusInput),this.props.storeHasFocus(this.hasFocus),this.inputObserver=new MutationObserver(this.onInputMutation),this.inputObserver.observe(this.inputField,{characterData:!0,childList:!0,subtree:!0})}componentWillUnmount(){Object(g.invoke)(this,"inputField.removeEventListener","paste",this.parsePastedInput,!1),this.inputObserver.disconnect()}render(){var{note:e,tags:t,value:o}=this.props,i=null;if(o.length>0)for(var n of t.values())if(!e.tags.includes(n.name)&&n.name.startsWith(o)){i=n.name;break}var s=""===o&&!this.state.isComposing;return r.a.createElement("div",{className:"tag-input",onClick:()=>{this.caretPosition=b(this.inputField),this.focusInput()}},s&&r.a.createElement("span",{"aria-hidden":!0,className:"tag-input__placeholder theme-color-fg-dim"},"Add tag…"),r.a.createElement("div",{"aria-label":"Add tag…",ref:this.storeInput,className:"tag-input__entry",contentEditable:"true",onBlur:this.submitTag,onCompositionStart:()=>this.setState({isComposing:!0}),onCompositionEnd:this.onCompositionEnd,onKeyDown:this.interceptKeys,spellCheck:!1,suppressContentEditableWarning:!0},o),r.a.createElement("div",{className:"tag-input__suggestion",disabled:!0,type:"text"},i?i.substring(o.length):""))}}n()(S,"displayName","TagInput"),n()(S,"defaultProps",{inputRef:g.identity,onChange:g.identity,onSelect:g.identity,storeFocusInput:g.noop,storeHasFocus:g.noop});var C=Object(a.b)(e=>({note:e.data.notes.get(e.ui.openedNote),tags:e.data.tags}))(S),y=o(20),E=o.n(y),w=o(68),T=o(67);class N extends s.Component{constructor(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];super(...t),n()(this,"container",Object(s.createRef)()),n()(this,"focusInput",void 0),n()(this,"hiddenTag",void 0),n()(this,"inputHasFocus",void 0),n()(this,"tagInput",Object(s.createRef)()),n()(this,"state",{selectedTag:"",showEmailTooltip:!1,tagInput:""}),n()(this,"addTag",e=>{var{note:t,noteId:o}=this.props,i=e.trim().replace(/\s+/g,",").split(",");i.some(p.a)&&this.showEmailTooltip();var n=new Set(t.tags.map(w.a));i.forEach(e=>{n.has(Object(w.a)(e))||(n.add(Object(w.a)(e)),this.props.addTag(o,e))}),this.storeTagInput(""),Object(g.invoke)(this,"tagInput.focus")}),n()(this,"hasSelection",()=>this.state.selectedTag&&!!this.state.selectedTag.length),n()(this,"deleteTag",e=>{var{noteId:t}=this.props,{selectedTag:o}=this.state;this.props.removeTag(t,e),o===e&&this.setState({selectedTag:""},()=>{var e,t;return null===(e=this.tagInput)||void 0===e||null===(t=e.current)||void 0===t?void 0:t.focus()})}),n()(this,"deleteSelection",()=>{this.hasSelection()&&this.deleteTag(this.state.selectedTag)}),n()(this,"hideEmailTooltip",()=>this.setState({showEmailTooltip:!1})),n()(this,"hasFocus",()=>!!this.inputHasFocus&&this.inputHasFocus()),n()(this,"focusTagField",()=>this.focusInput&&this.focusInput()),n()(this,"interceptKeys",e=>{if(8===e.which){if(""!==this.state.tagInput)return;return this.hasSelection()&&this.deleteSelection(),this.selectLastTag(),void e.preventDefault()}if(39===e.which&&this.hasSelection())return this.unselect(e),void this.focusTagField();(9===e.which&&this.hasSelection()||this.hasSelection())&&this.unselect(e)}),n()(this,"preventStealingFocus",e=>{var{ctrlKey:t,key:o,metaKey:i,shiftKey:n}=e;if(this.props.keyboardShortcuts)return(t||i)&&n&&"y"===o.toLowerCase()&&this.setState({selectedTag:""}),!0}),n()(this,"selectLastTag",()=>{var e;return this.setState({selectedTag:null===(e=this.props.note)||void 0===e?void 0:e.tags.slice(-1).shift()})}),n()(this,"selectTag",e=>{var{currentTarget:{dataset:{tagName:t}}}=e;e.preventDefault(),e.stopPropagation(),this.deleteTag(t)}),n()(this,"showEmailTooltip",()=>{this.setState({showEmailTooltip:!0}),setTimeout(()=>this.setState({showEmailTooltip:!1}),5e3)}),n()(this,"onKeyDown",e=>(this.state.showEmailTooltip&&this.hideEmailTooltip(),this.interceptKeys(e))),n()(this,"storeFocusInput",e=>this.focusInput=e),n()(this,"storeHasFocus",e=>this.inputHasFocus=e),n()(this,"storeHiddenTag",e=>this.hiddenTag=e),n()(this,"storeInputRef",e=>this.tagInput=e),n()(this,"storeTagInput",(e,t)=>this.setState({tagInput:e},t)),n()(this,"unselect",e=>{var t,o;this.state.selectedTag&&((null===(t=this.hiddenTag)||void 0===t?void 0:t.current)===e.relatedTarget&&void 0!==(null===(o=this.hiddenTag)||void 0===o?void 0:o.current)||this.setState({selectedTag:""}))})}componentDidMount(){this.props.storeFocusTagField(this.focusTagField),this.props.storeHasFocus(this.hasFocus),document.addEventListener("click",this.unselect,!0),window.addEventListener("keydown",this.preventStealingFocus,!0)}componentWillUnmount(){document.removeEventListener("click",this.unselect,!0),window.removeEventListener("keydown",this.preventStealingFocus,!0)}componentDidUpdate(){var e,t;this.hasSelection()&&(null===(e=this.hiddenTag)||void 0===e||null===(t=e.current)||void 0===t||t.focus())}render(){var{tags:e}=this.props,{selectedTag:t,showEmailTooltip:o,tagInput:i}=this.state;return r.a.createElement("div",{ref:this.container,className:"tag-field"},r.a.createElement("div",{"aria-label":"List of tags for the current note, click a tag to remove it",className:E()("tag-editor",{"has-selection":this.hasSelection()}),tabIndex:-1,onKeyDown:this.onKeyDown},r.a.createElement("input",{"aria-hidden":"true",className:"hidden-tag",tabIndex:-1,ref:this.storeHiddenTag}),e.map(e=>r.a.createElement(f.a,{key:e,tagName:e,selected:e===t,onSelect:this.selectTag})),r.a.createElement(C,{inputRef:this.storeInputRef,value:i,onChange:this.storeTagInput,onSelect:this.addTag,storeFocusInput:this.storeFocusInput,storeHasFocus:this.storeHasFocus}),r.a.createElement(h.a,{container:this.container.current,onHide:this.hideEmailTooltip,placement:"top",rootClose:!0,shouldUpdatePosition:!0,show:o,target:this.tagInput.current},()=>r.a.createElement(v,null))))}}n()(N,"displayName","TagField");var k=Object(a.b)(e=>{var t=e.ui.openedNote,o=t?e.data.notes.get(t):void 0;return{tags:t?Object(T.e)(e,o):[],keyboardShortcuts:e.settings.keyboardShortcuts,noteId:t,note:o}},{addTag:(e,t)=>({type:"ADD_NOTE_TAG",noteId:e,tagName:t}),removeTag:(e,t)=>({type:"REMOVE_NOTE_TAG",noteId:e,tagName:t})})(N),I=o(648),M=o(704),F=o(226),O=o(472),x=o(214),L=o(286),D=o(298),K=o(21),R=o(314);function A(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function P(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?A(Object(o),!0).forEach((function(t){n()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):A(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var _=e=>({range:new M.Range(e,1,e,1),options:{isWholeLine:!0,inlineClassName:"note-title",stickiness:M.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}});class j extends s.Component{constructor(){super(...arguments),n()(this,"bootTimer",null),n()(this,"editor",null),n()(this,"monaco",null),n()(this,"contentDiv",Object(s.createRef)()),n()(this,"decorations",[]),n()(this,"matchesInNote",[]),n()(this,"state",{content:"",editor:"fast",noteId:null,overTodo:!1,searchQuery:""}),n()(this,"toggleShortcuts",e=>{e?window.addEventListener("keydown",this.handleShortcut,!0):window.removeEventListener("keydown",this.handleShortcut,!0)}),n()(this,"completionProvider",(e,t)=>({triggerCharacters:["["],provideCompletionItems(t,o,i,n){var s=t.getLineContent(o.lineNumber),r=s.lastIndexOf("[",o.column),a=s.lastIndexOf("]",o.column),l=r>=0&&a<r?r:-1,c=l>=0?s.slice(l+1,o.column):"",d=Object(O.b)({collection:{type:"all"},excludeIDs:e?[e]:[],searchTags:Object(O.c)(c),searchTerms:Object(L.a)(c),titleOnly:!0},5).map(e=>{var[t,o]=e;return P({noteId:t,content:o.content,isPinned:o.systemTags.includes("pinned")},Object(D.c)(o))}),u=l>=0?[{text:"",range:{startLineNumber:o.lineNumber,startColumn:l,endLineNumber:o.lineNumber,endColumn:o.column}}]:[];return{incomplete:!0,suggestions:d.map((e,t)=>({additionalTextEdits:u,kind:e.isPinned?M.languages.CompletionItemKind.Snippet:M.languages.CompletionItemKind.File,label:e.title,documentation:e.content,insertText:"[".concat(e.title,"](simplenote://note/").concat(e.noteId,")"),sortText:t.toString(),range:{startLineNumber:o.lineNumber,startColumn:o.column,endLineNumber:o.lineNumber,endColumn:o.column}}))}}})),n()(this,"handleShortcut",e=>{var{ctrlKey:t,metaKey:o,shiftKey:i}=e,n=e.key.toLowerCase(),s=t||o;return s&&i&&"g"===n?(this.setPrevSearchSelection(),e.stopPropagation(),e.preventDefault(),!1):window.electron||!s||i||"g"!==n?void 0:(this.setNextSearchSelection(),e.stopPropagation(),e.preventDefault(),!1)}),n()(this,"setDecorators",()=>{var e,t;this.matchesInNote=null!==(e=this.searchMatches())&&void 0!==e?e:[],this.props.storeNumberOfMatchesInNote(this.matchesInNote.length);var o=null!==(t=this.getTitleDecoration())&&void 0!==t?t:[];this.decorations=this.editor.deltaDecorations(this.decorations,[...this.matchesInNote,...o])}),n()(this,"getTitleDecoration",()=>{var e=this.editor.getModel();if(e)for(var t=1;t<=e.getLineCount();t++){if(e.getLineContent(t).trim().length>0)return[_(t)]}}),n()(this,"searchMatches",()=>{if(this.editor&&this.props.searchQuery){var e=this.editor.getModel(),t=Object(L.a)(this.props.searchQuery).map(e=>e.normalize().toLowerCase()).filter(e=>e.trim().length>0);if(0===t.length)return[];var o=e.getValue().normalize().toLowerCase();return t.reduce((t,i)=>{for(var n=null,s=0;-1!==n&&-1!==(n=o.indexOf(i,s));){s=n+i.length;var r=e.getPositionAt(n),a=e.getPositionAt(n+i.length);t.push({options:{inlineClassName:"search-decoration",overviewRuler:{color:"#3361cc",position:M.editor.OverviewRulerLane.Full}},range:{startLineNumber:r.lineNumber,startColumn:r.column,endLineNumber:a.lineNumber,endColumn:a.column}})}return t},[])}}),n()(this,"focusEditor",()=>{var e;return null===(e=this.editor)||void 0===e?void 0:e.focus()}),n()(this,"hasFocus",()=>{var e;return null===(e=this.editor)||void 0===e?void 0:e.hasTextFocus()}),n()(this,"handleChecklist",e=>{var t;null===(t=this.editor)||void 0===t||t.trigger("editorCommand","insertChecklist",null)}),n()(this,"handleUndoRedo",e=>{var t,o;switch(e.inputType){case"historyUndo":return null===(t=this.editor)||void 0===t||t.trigger("browserMenu","undo",null),e.preventDefault(),void e.stopPropagation();case"historyRedo":return null===(o=this.editor)||void 0===o||o.trigger("browserMenu","redo",null),e.preventDefault(),void e.stopPropagation()}}),n()(this,"cancelSelectionOrSearch",e=>{this.props.searchQuery.length>0&&this.matchesInNote.length>0?this.props.clearSearch():e.trigger("customAction","cancelSelection",null)}),n()(this,"insertOrRemoveCheckboxes",e=>{var t=e.getSelection();if(t)for(var o=t.startLineNumber;o<=t.endLineNumber;o++)this.toggleChecklistForLine(e,o);else{var i=e.getPosition();if(!i)return;this.toggleChecklistForLine(e,i.lineNumber)}}),n()(this,"toggleChecklistForLine",(e,t)=>{var o,i,n=e.getModel();if(n){var s=n.getLineContent(t),r=/^(\s*)([-+*\u2022]\s*)?([\ue000\ue001]\s+)?/.exec(s);if(r){var[a,l,c,d]=r,u=void 0!==d,h=l.length+(null!==(o=null==c?void 0:c.length)&&void 0!==o?o:0)+1,g=u?"":" ",p={identifier:{major:1,minor:1},range:new this.monaco.Range(t,h,t,h+(null!==(i=null==d?void 0:d.length)&&void 0!==i?i:0)),text:g,forceMoveMarkers:!0};e.executeEdits("insertOrRemoveCheckboxes",[p]),this.props.insertTask()}}}),n()(this,"editorInit",e=>{M.editor.defineTheme("simplenote",{base:"vs",inherit:!0,rules:[{background:"FFFFFF",foreground:"#2c3338"}],colors:{"editor.foreground":"#2c3338","editor.background":"#ffffff","editor.selectionBackground":"#ced9f2","scrollbarSlider.activeBackground":"#8c8f94","scrollbarSlider.background":"#c3c4c7","scrollbarSlider.hoverBackground":"#a7aaad","textLink.foreground":"#1d4fc4"}}),M.editor.defineTheme("simplenote-dark",{base:"vs-dark",inherit:!0,rules:[{background:"1d2327",foreground:"ffffff"}],colors:{"editor.foreground":"#ffffff","editor.background":"#1d2327","editor.selectionBackground":"#646970","scrollbarSlider.activeBackground":"#646970","scrollbarSlider.background":"#2c3338","scrollbarSlider.hoverBackground":"#1d2327","textLink.foreground":"#ced9f2"}})}),n()(this,"editorReady",(e,t)=>{var o,i,n;this.editor=e,this.monaco=t,t.languages.registerLinkProvider("plaintext",{provideLinks:e=>({links:e.findMatches("simplenote://note/[a-zA-Z0-9-]+",!0,!0,!1,null,!1).map(e=>{var{range:t}=e;return{range:t}})}),resolveLink:t=>{var o,i,n=null!==(o=null===(i=e.getModel())||void 0===i?void 0:i.getValueInRange(t.range))&&void 0!==o?o:"",s=/^simplenote:\/\/note\/(.+)$/.exec(n);if(s){var[r,a]=s;return this.props.notes.has(a)&&this.props.openNote(a),P(P({},t),{},{url:"#"})}}});var s=["cancelSelection","cursorUndo","editor.action.commentLine","editor.action.jumpToBracket","editor.action.transposeLetters","expandLineSelection","editor.action.gotoLine","editor.action.insertCursorAbove","editor.action.insertCursorBelow","editor.action.insertCursorAtEndOfEachLineSelected","actions.find","actions.findWithSelection","editor.action.addSelectionToNextFindMatch","editor.action.nextMatchFindAction","editor.action.selectHighlights"];window.electron&&K.d&&s.push("undo","redo","editor.action.selectAll"),s.forEach((function(t){e._standaloneKeybindingService.addDynamicKeybinding("-"+t,void 0,()=>{})})),e.createContextKey("allowBrowserKeybinding",!window.electron),e.addAction({id:"context_undo",label:"Undo",keybindings:[t.KeyMod.CtrlCmd|t.KeyCode.KEY_Z],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"1_modification",contextMenuOrder:2,run:()=>{e.trigger("contextMenu","undo",null)}}),e.addAction({id:"context_redo",label:"Redo",keybindings:[t.KeyMod.WinCtrl|t.KeyCode.KEY_Y,t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.KEY_Z],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"1_modification",contextMenuOrder:3,run:()=>{e.trigger("contextMenu","redo",null)}}),e.addAction({id:"context_cut",label:"Cut",keybindings:[t.KeyMod.CtrlCmd|t.KeyCode.KEY_X],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:1,run:()=>{e.trigger("contextMenu","editor.action.clipboardCutAction",null)}}),e.addAction({id:"context_copy",label:"Copy",keybindings:[t.KeyMod.CtrlCmd|t.KeyCode.KEY_C],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:2,run:()=>{e.trigger("contextMenu","editor.action.clipboardCopyAction",null)}}),e.addAction({id:"cancel_selection",label:"Cancel Selection",keybindings:[t.KeyCode.Escape],keybindingContext:"!suggestWidgetVisible",run:this.cancelSelectionOrSearch}),window.electron&&e.addAction({id:"paste",label:"Paste",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:3,keybindings:[t.KeyMod.CtrlCmd|t.KeyCode.KEY_V],keybindingContext:"allowBrowserKeybinding",run:()=>{document.execCommand("paste")}}),e.addAction({id:"select_all",label:"Select All",contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:4,keybindings:[t.KeyMod.CtrlCmd|t.KeyCode.KEY_A],keybindingContext:"allowBrowserKeybinding",run:()=>{e.setSelection(e.getModel().getFullModelRange())}}),e.addAction({id:"insertChecklist",label:"Insert Checklist",keybindings:[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.KEY_C,t.KeyMod.WinCtrl|t.KeyMod.Shift|t.KeyCode.KEY_C],keybindingContext:"allowBrowserKeybinding",contextMenuGroupId:"10_checklist",contextMenuOrder:1,run:this.insertOrRemoveCheckboxes}),e.addAction({id:"selectUpWithoutMulticursor",label:"Select Up",keybindings:[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.UpArrow],run:()=>{e.trigger("shortcuts","cursorUpSelect",null)}}),e.addAction({id:"selectDownWithoutMulticursor",label:"Select Down",keybindings:[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.DownArrow],run:()=>{e.trigger("shortcuts","cursorDownSelect",null)}}),e.addCommand(t.KeyCode.Tab,()=>{var t,o,i=null===(t=e.getPosition())||void 0===t?void 0:t.lineNumber;if(i){var n=null===(o=e.getModel())||void 0===o?void 0:o.getLineContent(i);n&&/^(\s*)([-+*\u2022\ue000\ue001])(\s+)/.test(n)?e.trigger("commands","editor.action.indentLines",null):e.trigger("commands","tab",null)}}),null===(o=window.electron)||void 0===o||o.receive("editorCommand",t=>{switch(t.action){case"findAgain":return void this.setNextSearchSelection();case"insertChecklist":return void e.trigger("editorCommand","insertChecklist",null);case"redo":return void(e.hasTextFocus()?e.trigger("editorCommand","redo",null):document.execCommand("redo"));case"selectAll":return void(e.hasTextFocus()?e.setSelection(e.getModel().getFullModelRange()):document.execCommand("selectAll"));case"undo":return void(e.hasTextFocus()?e.trigger("editorCommand","undo",null):document.execCommand("undo"))}}),window.electron||window.addEventListener("input",this.handleUndoRedo,!0),this.setDecorators(),this.setState({}),e.onDidChangeModelContent(()=>this.setDecorators());var r=t.languages.registerCompletionItemProvider("plaintext",this.completionProvider(this.state.noteId,e));e.onDidDispose(()=>null==r?void 0:r.dispose()),t.languages.setLanguageConfiguration("plaintext",{wordPattern:/[^\s]+/g}),document.oncopy=e=>{e.clipboardData.setData("text/plain",Object(R.c)(e.clipboardData.getData("text/plain")))};var[a,l,c]=this.props.editorSelection,d=null===(i=this.editor.getModel())||void 0===i?void 0:i.getPositionAt(a),u=null===(n=this.editor.getModel())||void 0===n?void 0:n.getPositionAt(l);this.editor.setSelection(M.Selection.createWithDirection(null==d?void 0:d.lineNumber,null==d?void 0:d.column,null==u?void 0:u.lineNumber,null==u?void 0:u.column,"RTL"===c?M.SelectionDirection.RTL:M.SelectionDirection.LTR)),e.revealLine(d.lineNumber,M.editor.ScrollType.Immediate),e.onDidChangeCursorSelection(t=>{var o,i;if(t.reason!==M.editor.CursorChangeReason.Undo&&t.reason!==M.editor.CursorChangeReason.Redo){var n=null===(o=e.getModel())||void 0===o?void 0:o.getOffsetAt(t.selection.getStartPosition()),s=null===(i=e.getModel())||void 0===i?void 0:i.getOffsetAt(t.selection.getEndPosition()),r=t.selection.getDirection()===M.SelectionDirection.LTR?"LTR":"RTL";this.props.storeEditorSelection(this.props.noteId,n,s,r)}}),e.onMouseMove(t=>{var{content:o}=this.state,{target:{range:i}}=t;if(i&&!(i.endColumn-i.startColumn>1)){var n=e.getModel();if(n){var s=n.getOffsetAt({lineNumber:i.startLineNumber,column:i.startColumn}),r=""===o[s]||""===o[s];this.state.overTodo!==r&&this.setState({overTodo:r})}}}),e.onMouseDown(t=>{var{editNote:o,noteId:i}=this.props,{content:n}=this.state,{target:{range:s}}=t;if(s&&!(s.endColumn-s.startColumn>1)){var r=e.getModel();if(r){var a=r.getOffsetAt({lineNumber:s.startLineNumber,column:s.startColumn});""===n[a]?o(i,{content:Object(R.c)(n.slice(0,a)+""+n.slice(a+1))}):""===n[a]&&o(i,{content:Object(R.c)(n.slice(0,a)+""+n.slice(a+1))})}}})}),n()(this,"updateNote",(e,t)=>{var{editNote:o,noteId:i}=this.props;if(this.editor){var n=(()=>{if(this.editor&&!t.isRedoing&&!t.isUndoing){var o=t.changes.find(e=>{var{text:t}=e;return("\r"===t[0]||"\n"===t[0])&&""===t.trim()});if(o){var i=o.range.startLineNumber;if(0!==i&&i===o.range.endLineNumber){var n=this.editor.getModel(),s=n.getLineContent(i),r=/^(\s*)([-+*\u2022\ue000\ue001])(\s+)/.exec(s);if(null!==r){var a=n.getLineContent(i+1);if(/^\s*$/.test(a)){if(!(0===a.trim().length&&s.length===r[0].length)){var l=n.getOffsetAt({column:0,lineNumber:i+1}),c=n.getOffsetAt({column:0,lineNumber:i+2}),d={identifier:{major:1,minor:1},range:new this.monaco.Range(i+1,0,i+1,a.length),text:r[0].replace("",""),forceMoveMarkers:!0};return this.editor.executeEdits("autolist",[d]),Promise.resolve().then(()=>this.editor.setPosition({column:r[0].length+1,lineNumber:i+1})),e.slice(0,l)+r[0].replace("","")+t.eol+e.slice(c)}n.getOffsetAt({column:0,lineNumber:i}),n.getOffsetAt({column:0,lineNumber:i+1});var u={identifier:{major:1,minor:1},range:new this.monaco.Range(i,0,i+1,a.length+1),text:null,forceMoveMarkers:!0};Promise.resolve().then(()=>{this.editor.executeEdits("autolist",[u]),this.editor.setPosition({column:0,lineNumber:i})})}}}}}})()||e;o(i,{content:Object(R.c)(n)})}}),n()(this,"setNextSearchSelection",()=>{var{selectedSearchMatchIndex:e}=this.props,t=this.matchesInNote.length,o=(t+(null!=e?e:-1)+1)%t;this.props.storeSearchSelection(o),this.setSearchSelection(o),this.focusEditor()}),n()(this,"setPrevSearchSelection",()=>{var{selectedSearchMatchIndex:e}=this.props,t=this.matchesInNote.length,o=(t+(null!=e?e:t)-1)%t;this.props.storeSearchSelection(o),this.setSearchSelection(o),this.focusEditor()}),n()(this,"setSearchSelection",e=>{if(this.matchesInNote.length&&null!==e){var t=this.matchesInNote[e].range;this.editor.setSelection(t),this.editor.revealLineInCenter(t.startLineNumber);var o=[];this.matchesInNote.forEach(e=>{var i={};i=e.range===t?{range:e.range,options:{inlineClassName:"selected-search"}}:{range:e.range,options:{inlineClassName:"search-decoration"}},o.push(i)}),this.decorations=this.editor.deltaDecorations(this.decorations,o)}})}static getDerivedStateFromProps(e,t){var o=e.note.content.length>5e3,i=e.note.content!==t.content,n=e.noteId!==t.noteId,s=i?n&&o?e.note.content.slice(0,e.editorSelection[1]+5e3):Object(R.b)(e.note.content):t.content,r=n?o?"fast":"full":t.editor,a=e.searchQuery!==t.searchQuery;return(n||a)&&e.storeSearchSelection(null),{content:s,editor:r,noteId:e.noteId,searchQuery:e.searchQuery}}componentDidMount(){var{noteId:e}=this.props;this.bootTimer=setTimeout(()=>{e===this.props.noteId&&this.setState({editor:"full",content:Object(R.b)(this.props.note.content)})},120),this.focusEditor(),this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus),window.addEventListener("toggleChecklist",this.handleChecklist,!0),this.toggleShortcuts(!0);((e,t)=>{var o=e._first;do{var i,n;t.includes(null===(i=o.element)||void 0===i||null===(n=i.command)||void 0===n?void 0:n.id)&&e._remove(o)}while(o=o.next)})([...F.d._menuItems].find(e=>"EditorContext"===e[0]._debugName)[1],["editor.action.changeAll","editor.action.clipboardCutAction","editor.action.clipboardCopyAction","editor.action.clipboardPasteAction","editor.action.quickCommand"])}componentWillUnmount(){var e;this.bootTimer&&clearTimeout(this.bootTimer),null===(e=window.electron)||void 0===e||e.removeListener("editorCommand"),window.removeEventListener("input",this.handleUndoRedo,!0),window.removeEventListener("toggleChecklist",this.handleChecklist,!0),this.toggleShortcuts(!1)}componentDidUpdate(e){var t,o,{editorSelection:[i,n,s]}=e,{editorSelection:[r,a,l]}=this.props;if(this.editor&&"full"===this.state.editor&&(i!==r||n!==a||s!==l)){var c,d,u=null===(c=this.editor.getModel())||void 0===c?void 0:c.getPositionAt(r),h=null===(d=this.editor.getModel())||void 0===d?void 0:d.getPositionAt(a);this.editor.setSelection(M.Selection.createWithDirection(null==u?void 0:u.lineNumber,null==u?void 0:u.column,null==h?void 0:h.lineNumber,null==h?void 0:h.column,"RTL"===l?M.SelectionDirection.RTL:M.SelectionDirection.LTR))}""===this.props.searchQuery&&""!==e.searchQuery&&(null===(t=this.editor)||void 0===t||t.setSelection(new this.monaco.Range(0,0,0,0)));(this.props.lineLength===e.lineLength&&this.props.isFocusMode===e.isFocusMode||setTimeout(()=>{this.editor&&this.editor.layout()},400),this.editor&&"full"===this.state.editor&&e.searchQuery!==this.props.searchQuery)&&(null===(o=this.editor)||void 0===o||o.layout(),this.setDecorators());this.editor&&"full"===this.state.editor&&e.selectedSearchMatchIndex!==this.props.selectedSearchMatchIndex&&this.setSearchSelection(this.props.selectedSearchMatchIndex)}render(){var e,{lineLength:t,noteId:o,searchQuery:i,theme:n}=this.props,{content:s,editor:a,overTodo:l}=this.state,c=(i&&this.searchMatches(),((e,t)=>"full"===e||void 0===t?25:t<=1072?.1*t:(t-768)/2)(t,null===(e=this.contentDiv.current)||void 0===e?void 0:e.offsetWidth));return r.a.createElement("div",{ref:this.contentDiv,className:"note-content-editor-shell".concat(l?" cursor-pointer":""),onClick:this.focusEditor},r.a.createElement("div",{className:"note-content-plaintext".concat("fast"===a?" visible":"")},s),"fast"!==a&&r.a.createElement(I.default,{key:o,editorDidMount:this.editorReady,editorWillMount:this.editorInit,language:"plaintext",theme:"dark"===n?"simplenote-dark":"simplenote",onChange:this.updateNote,options:{autoClosingBrackets:"never",autoClosingQuotes:"never",autoIndent:"keep",autoSurround:"never",automaticLayout:!0,codeLens:!1,folding:!1,fontFamily:'"Simplenote Tasks", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen-Sans", "Ubuntu", "Cantarell", "Helvetica Neue", sans-serif',hideCursorInOverviewRuler:!0,lineDecorationsWidth:c,fontSize:16,lineHeight:24,lineNumbers:"off",links:!0,matchBrackets:"never",minimap:{enabled:!1},occurrencesHighlight:!1,overviewRulerBorder:!1,quickSuggestions:!1,renderIndentGuides:!1,renderLineHighlight:"none",scrollbar:{horizontal:"hidden",useShadows:!1,verticalScrollbarSize:c},scrollBeyondLastLine:!1,selectionHighlight:!1,suggestOnTriggerCharacters:!0,unusualLineTerminators:"auto",wordWrap:"bounded",wrappingStrategy:K.e?"simple":"advanced",wordWrapColumn:400},value:s}))}}var H={clearSearch:()=>x.a.ui.search(""),editNote:x.a.data.editNote,insertTask:()=>({type:"INSERT_TASK"}),openNote:x.a.ui.selectNote,storeEditorSelection:(e,t,o,i)=>({type:"STORE_EDITOR_SELECTION",noteId:e,start:t,end:o,direction:i}),storeNumberOfMatchesInNote:e=>({type:"STORE_NUMBER_OF_MATCHES_IN_NOTE",matches:e}),storeSearchSelection:e=>({type:"STORE_SEARCH_SELECTION",index:e})},B=Object(a.b)(e=>{var t;return{editorSelection:null!==(t=e.ui.editorSelection.get(e.ui.openedNote))&&void 0!==t?t:[0,0,"LTR"],isFocusMode:e.settings.focusModeEnabled,keyboardShortcuts:e.settings.keyboardShortcuts,lineLength:e.settings.lineLength,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),notes:e.data.notes,searchQuery:e.ui.searchQuery,selectedSearchMatchIndex:e.ui.selectedSearchMatchIndex,spellCheckEnabled:e.settings.spellCheckEnabled,theme:T.b(e)}},H)(j),U=o(386);class W extends s.Component{constructor(){super(...arguments),n()(this,"focusEditor",()=>this.focusContentEditor&&this.focusContentEditor()),n()(this,"hasFocus",()=>{var e;return null===(e=this.editorHasFocus)||void 0===e?void 0:e.call(this)}),n()(this,"storeEditorHasFocus",e=>this.editorHasFocus=e),n()(this,"storeFocusContentEditor",e=>this.focusContentEditor=e)}componentDidMount(){this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus)}render(){var{openedNote:e}=this.props;return r.a.createElement("div",{className:"note-detail-wrapper"},e?r.a.createElement(B,{key:e,storeFocusEditor:this.storeFocusContentEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(U.a,null)))}}n()(W,"displayName","NoteDetail");var Q=Object(a.b)(e=>({isDialogOpen:e.ui.dialogs.length>0,keyboardShortcuts:e.settings.keyboardShortcuts,openedNote:e.ui.openedNote}))(W),G=o(537);class Y extends s.Component{constructor(){super(...arguments),n()(this,"markdownEnabled",()=>{var e;return null===(e=this.props.note)||void 0===e?void 0:e.systemTags.includes("markdown")}),n()(this,"handleShortcut",e=>{if(this.props.keyboardShortcuts){var t,o,{ctrlKey:i,metaKey:n,shiftKey:s}=e,r=e.key.toLowerCase(),{note:a,noteId:l,toggleMarkdown:c}=this.props,d=i||n;return a&&d&&s&&"m"===r?(c(l,!this.markdownEnabled()),e.stopPropagation(),e.preventDefault(),!1):d&&s&&"p"===r&&this.markdownEnabled()?(this.props.toggleEditMode(),e.stopPropagation(),e.preventDefault(),!1):!(s&&d&&"y"===r&&this.props.isEditorActive)||(!this.editFieldHasFocus()||this.props.isSearchActive?(null===(t=this.focusNoteEditor)||void 0===t||t.call(this),e.stopPropagation(),e.preventDefault(),!1):(null===(o=this.focusTagField)||void 0===o||o.call(this),e.stopPropagation(),e.preventDefault(),!1))}}),n()(this,"editFieldHasFocus",()=>this.editorHasFocus&&this.editorHasFocus()),n()(this,"storeEditorHasFocus",e=>this.editorHasFocus=e),n()(this,"storeFocusEditor",e=>this.focusNoteEditor=e),n()(this,"storeFocusTagField",e=>this.focusTagField=e),n()(this,"storeTagFieldHasFocus",e=>this.tagFieldHasFocus=e),n()(this,"tagFieldHasFocus",()=>this.tagFieldHasFocus&&this.tagFieldHasFocus()),n()(this,"toggleShortcuts",e=>{e?window.addEventListener("keydown",this.handleShortcut,!0):window.removeEventListener("keydown",this.handleShortcut,!0)})}componentDidMount(){this.toggleShortcuts(!0)}componentWillUnmount(){this.toggleShortcuts(!1)}render(){var{editMode:e,hasSearchQuery:t,hasSearchMatchesInNote:o,note:i,noteId:n}=this.props;if(!i)return r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(U.a,null));var s=!!i.deleted;return r.a.createElement("div",{className:"note-editor theme-color-bg theme-color-fg"},e||!i.systemTags.includes("markdown")?r.a.createElement(Q,{storeFocusEditor:this.storeFocusEditor,storeHasFocus:this.storeEditorHasFocus}):r.a.createElement(G.default,{noteId:n}),i&&!s&&r.a.createElement(k,{storeFocusTagField:this.storeFocusTagField,storeHasFocus:this.storeTagFieldHasFocus}),t&&o&&r.a.createElement(u,null))}}n()(Y,"displayName","NoteEditor");var z={toggleNoteList:x.a.ui.toggleNoteList,toggleMarkdown:x.a.data.markdownNote,toggleEditMode:x.a.ui.toggleEditMode};t.default=Object(a.b)(e=>({allTags:e.data.tags,editMode:e.ui.editMode,keyboardShortcuts:e.settings.keyboardShortcuts,isEditorActive:!e.ui.showNavigation,noteId:e.ui.openedNote,note:e.data.notes.get(e.ui.openedNote),revision:e.ui.selectedRevision,hasSearchQuery:""!==e.ui.searchQuery,hasSearchMatchesInNote:!!e.ui.numberOfMatchesInNote&&e.ui.numberOfMatchesInNote>0,isSearchActive:!!e.ui.searchQuery.length,isSmallScreen:T.d(e)}),z)(Y)}}]);